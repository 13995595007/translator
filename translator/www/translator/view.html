<!-- jinja -->
<!-- no-sidebar -->
{% set lang = frappe.get_doc("Language", frappe.form_dict.lang) %}
{% set karma = frappe.db.get_value("User", frappe.user, "karma") or 0 %}

<script>
window.language_name = "{{ lang.language_name }}";
window.user_karma = {{ karma }};
window.lang = "{{ frappe.form_dict.lang }}";

frappe.ready(function() {
	$(".page-header h2").html("Translate " + window.language_name);
	document.title = "Translate " + window.language_name;
	$("[data-char='"+(get_url_arg("c") || "*")+"']").addClass("active");

	$(".message-ts").each(function() {
		var ts = $(this).attr("data-timestamp");
		$(this).html("Last Updated: "
		 + (comment_when(ts) || ts));
	});

	$("input#search-box").keyup(function(event){
		if(event.keyCode == 13){
			search_param = $(this).val()
			lang = get_parameter_by_name('lang')
			if (search_param && lang) {
				window.location = "/translator/view?lang="+lang+"&search="+search_param
			}
		}
	});
})
</script>

<div class="reset">
	<input type="text" id="search-box" class="form-control" placeholder="Search for...">
</div>

<ul class="pagination">
{% for c in "*ABCDEFGHIJKLMNOPQRSTUVWXYZ" %}
 	<li data-char="{{ c }}">
		<a href="/translator/view?c={{ c }}&lang={{ frappe.form_dict.lang }}">{{ c }}</a>
	</li>
{% endfor %}
</ul>



{% if frappe.user == "Guest" %}
<div class="alert alert-info">
	You must <a href="/login">login</a> to edit or verify  translations
</div>
{% else %}
<div class="alert alert-info">
	Please edit or verify translations. You have karma {{ karma }}!
</div>
<ol>
	<li>Click on the message to edit. </li>
	<li>For help, comments, <a href="https://github.com/frappe/translator/issues" target="_blank">please use GitHub Issues</a>. </li>
	<li>You get a karma point every time someone upvotes your edit. </li>
</ol>
<hr>
{% endif %}

{% for message in messages %}
{% if "<" not in message.message %}
<div class="row" style="margin-bottom: 7px; padding-bottom: 7px;
	border-bottom: 1px solid #f2f2f2;"
	data-message-id="{{ message.translated_name or '' }}" data-source-message-id="{{ message.source_name or '' }}">
	<div class="col-sm-5">
		<div>
			{{ message.message }}
			<i title="Badly formed message"
				class="icon-flag text-warning {{ '' if message.flagged else 'hide' }}"></i>
		</div>
		<div class="text-muted small">
			<span class="message-ts" data-timestamp="{{ message.modified }}">
				{{ message.modified }}
			</span>
			by {{ (message.first_name or "") + " " + (message.last_name or "") }}
		</div>
	</div>
	<div class="col-sm-5 translated
		{{ 'text-right' if frappe.form_dict.lang=='ar' else '' }}"
		data-verified="{{ message.verified or 0 }}" style="min-height: 20px; cursor: pointer;">
		{{ message.translated or '' }}
	</div>
	<div class="col-sm-2">
		{% if frappe.user != "Guest" %}
		<button
			class="btn btn-small btn-verify
				btn-{{ "success" if message.verified else "danger" }}"
			data-verified="{{ message.verified or 0 }}"
			>Verify ({{ message.verified or 0 }})</button>
		{% else %}
		<span
			class="label
				label-{{ "success" if message.verified else "danger" }}"
			>Verfied ({{ message.verified or 0 }})</span>
		{% endif %}
		{% if message.translated_name and message.modified_by != "Administrator" %}
		<i class="icon-ok" title="Edited"></i>
		{% endif %}
	</div>
</div>
{% endif %}
{% endfor %}
